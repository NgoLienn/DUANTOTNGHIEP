<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{zlayout/fragments :: html_head}"></head>
<link rel="stylesheet" th:href="@{../assets/css_main/cart.css}">
<style>
    .product-quantity a {
        text-decoration: none;
        color: #333;
        font-size: 18px;
        cursor: pointer;
    }

    .product-quantity input {
        width: 30px;
        text-align: center;
        margin: 0 10px;
        border: 1px solid #ddd;
        padding: 5px;
        font-size: 16px;
        color: #333;
    }
</style>

<body>

    <div th:replace="~{zlayout/loadAndCartSmall :: loader}"></div>

    <div th:replace="~{zlayout/loadAndCartSmall :: cartSmall}"></div>
    <div class="containerr ">
        <div class="image_big">
            <div class="image-one"></div>
            <div class="image-three"></div>
            <div class="image-two">
                <img src="/assets/images/leaves.png" alt="leaves.png" class="food2">
                <nav class="navb navbar-expand-lg navbar-light bg-light" th:replace="zlayout/navbar :: menu"></nav>

                <header class="banner-big">
                    <div class="img-blur ">
                        <!-- <img src="assets/images/food5.png" class="anh1" alt=""> -->
                    </div>
                    <div class="wraper">
                        <aside class="">
                            <div class="container-fluid text-cart py-4 mt-3 ">
                                <span class="tttk text-uppercase px-3">Giỏ Hàng</span>
                                <br>
                                <span class="px-3 mt-3 position-absolute text-giohang">Bạn có 4 sản phẩm trong giỏ
                                    hàng
                                </span>
                            </div>
                            <div th:if="${#lists.size(carts.cart_items) > 0}">
                                <div class="container-fluid py-4 mt-3">
                                    <div class="product-container">
                                        <div class="product-row header mb-4">
                                            <div class="product-cell1">Sản phẩm</div>
                                            <div class="product-cell">Đơn giá</div>
                                            <div class="product-cell">Số lượng</div>
                                            <div class="product-cell">Số tiền</div>
                                            <div class="product-cell">Thao Tác</div>
                                        </div>
                                        <div class="product-row" th:each="item : ${carts.cart_items}">
                                            <input type="checkbox" class="checkb_product custom-checkbox">
                                            <a href="/page/user/product_detail.html">
                                                <img th:src="@{'/assets/images/img_product/' + ${item.productId.image}}"
                                                    class="img-cell" alt="prod_pm">
                                            </a>
                                            <div class="product-cell-name" th:text="${item.productId.name}"></div>
                                            <div class="product-cell px-2" th:text="${item.sizeName}"></div>
                                            <div cl ass="product-cell " th:text="${item.price}"></div>
                                            <div class="product-quantity px-5">
                                                <a href="#" class="decrement-button"
                                                    th:data-cartitem-id="${item.cartitemID}">-</a>
                                                <input th:id="'quantity' + ${item.cartitemID}" type="text"
                                                    th:value="${item.quantity}" th:data-quantity="${item.quantity}"
                                                    readonly>
                                                <a href="#" class="increment-button disabled"
                                                    th:data-cartitem-id="${item.cartitemID}">+</a>

                                            </div>
                                            <span class=" price total-price product-cell px2">
                                                <span th:id="'current-price'  + ${item.cartitemID}"
                                                    th:text="${item.subtotal}">
                                                </span>
                                                &nbsp; &nbsp;
                                            </span>
                                            <div class="button-xoa">
                                                <a th:href="@{|/cart/remove/${item.cartitemID}|}"><button type="button"
                                                        class="btn">Xóa</button></a>
                                            </div>
                                        </div>
                                    </div>
                                    <hr>
                                </div>

                                <div class="shopping-cart-container mt-3 py-3 px-3">
                                    <div class="payment-container">
                                        <span class="text-payment">Tổng Thanh Toán: </span>
                                        <span class="px-4 price-payment-sum" id="price-payment-sum"
                                            th:text="${#numbers.formatDecimal(subtotal , 0, 'COMMA', 0, 'POINT')} + ' đ'">
                                        </span><br>
                                        <label for="selecAll" class="selecall">
                                            <span class="chk-all">
                                                <input type="checkbox" id="selecAll"> Chọn Tất Cả()
                                            </span>
                                        </label>
                                        <a th:href="@{/user/payment}">
                                            <button class="btn btn-danger btn-thanhtoan mt-3" type="submit">Mua
                                                Ngay</button>
                                        </a>

                                    </div>
                                </div>
                            </div>
                        </aside>
                    </div>
                </header>
            </div>

            <div class="footer" th:replace="~{zlayout/footer :: footer}"></div>
        </div>

        <a href="#" class="top-home"><span><i class="bi bi-arrow-up-square-fill"></i></span></a>
    </div>


    <script src="/assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>

    <script>
        // loading khi refresh
        var loader = function () {
            setTimeout(function () {
                $('#loader').css({ 'opacity': 0, 'visibility': 'hidden' });
            }, 2000);
        };
        $(function () {
            loader();
        });
        // end

        $(function () {
            $(window).scroll(function () {
                var scroll = $(window).scrollTop();
                if (scroll >= 1024) {
                    $(".navb").addClass("scrolled");
                } else {
                    $(".navb").removeClass("scrolled");
                }
            });
        });

        $(function () {
            $(".navbar-toggler").click(function () {
                $(".navbar-collapse").toggleClass("show");
            });
        });

        // nút mua hàng nằm phía trên màng hình
        window.addEventListener('scroll', function () {
            var paymentContainer = document.querySelector('.payment-container');
            if (window.scrollY <= paymentContainer.offsetHeight + paymentContainer.offsetLeft) {
                paymentContainer.classList.add('sticky');
            } else {
                paymentContainer.classList.remove('sticky');
            }
        });

        // end

        $(document).ready(function () {
            $(".increment-button").click(function (e) {
                e.preventDefault();
                var cartitemId = $(this).data("cartitem-id");
                var id = '#quantity' + cartitemId;
                var subtotal = '#current-price' + cartitemId;

                $.ajax({
                    type: "GET",
                    url: "/cart/updateCartItemss",
                    data: { cartitemID: cartitemId },
                    success: function (response) {
                        // Update the quantity on the page without refreshing
                        // You can do this dynamically based on your page structure
                        var updatedQuantity = $(response).find(id).data('quantity');
                        // Update the quantity on the page
                        $(id).val(updatedQuantity);// For simplicity, you can also reload the entire page
                        var currentPrice = $(response).find(subtotal).text();
                        $(subtotal).text(currentPrice);

                        var priceSum = $(response).find('#price-payment-sum').text();
                        $('#price-payment-sum').text(priceSum);
                    },
                    error: function (error) {
                        console.log("Error:", error);
                    }
                });
            });

            $(".decrement-button").click(function (e) {
                e.preventDefault();
                var cartitemId = $(this).data("cartitem-id");
                // console.log(cartitemId);
                var id = '#quantity' + cartitemId;
                var subtotal = '#current-price' + cartitemId;

                $.ajax({
                    type: "GET",
                    url: "/cart/updateCartItems",
                    data: { cartitemID: cartitemId },
                    success: function (response) {
                        // Update the quantity on the page without refreshing
                        // You can do this dynamically based on your page structure
                        var updatedQuantity = $(response).find(id).data('quantity');
                        // Update the quantity on the page
                        $(id).val(updatedQuantity); // For simplicity, you can also reload the entire page
                        var currentPrice = $(response).find(subtotal).text();
                        $(subtotal).text(currentPrice);

                        var priceSum = $(response).find('#price-payment-sum').text();
                        $('#price-payment-sum').text(priceSum);
                    },
                    error: function (error) {
                        console.log("Error:", error);
                    }
                });
            });
        });

    </script>
</body>

</html>